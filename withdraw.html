
<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>سحب النقاط</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body {
      margin: 0; padding: 0;
      font-family: Tahoma, Arial;
      background: linear-gradient(135deg, #141e30, #243b55);
      color: #fff; min-height: 100vh;
      display: flex; justify-content: center; align-items: center;
    }
    .box {
      background: rgba(0,0,0,0.6);
      width: 380px; padding: 25px;
      border-radius: 14px; text-align: center;
      box-shadow: 0 0 30px rgba(0,0,0,0.7);
    }
    h2 { color: #ffd700; margin-bottom: 10px; }
    input, button {
      width: 100%; padding: 12px; margin-top: 10px;
      border-radius: 8px; border: none; font-size: 15px;
    }
    input { outline: none; }
    button {
      background: #ffd700; color: #000;
      font-weight: bold; cursor: pointer;
    }
    button:hover { background: #ffea00; }
    .back { background: #c0392b; color: #fff; }
    .note { font-size: 13px; margin-top: 10px; color: #ddd; }
    .msg { margin-top: 10px; font-size: 14px; }
  </style>
</head>
<body>

<div class="box">
  <h2>سحب النقاط</h2>

  <input id="amount" type="number" placeholder="عدد النقاط (مثال: 50)">
  <input id="wallet" type="text" placeholder="عنوان محفظة USDT (TRC20)">

  <button onclick="requestWithdraw()">إرسال طلب السحب</button>
  <button class="back" onclick="goBack()">رجوع للوحة التحكم</button>

  <div class="note">
    ⚠️ الحد الأدنى للسحب: 50 نقطة<br>
    1 نقطة = 1 USDT
  </div>

  <div class="msg" id="msg"></div>
</div>

<script>
  const supabaseUrl = "https://gpfxakuneeuafxgqbobs.supabase.co";
  const supabaseKey = "sb_publishable_N7Rxa6cF70kZh28q3J_aWg_Na_oapEO";
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  async function requestWithdraw() {
    const amount = parseInt(document.getElementById("amount").value, 10);
    const wallet = document.getElementById("wallet").value.trim();
    const msg = document.getElementById("msg");

    if (!amount || amount < 50) {
      msg.innerText = "❌ الحد الأدنى للسحب 50 نقطة";
      return;
    }
    if (!wallet) {
      msg.innerText = "❌ أدخل عنوان المحفظة";
      return;
    }

    const { data: { user } } = await supabase.auth.getUser();
    if (!user) {
      window.location.href = "login.html";
      return;
    }

    // جلب الرصيد الحالي
    const { data, error } = await supabase
      .from("profiles")
      .select("points")
      .eq("user_id", user.id)
      .single();

    if (error) {
      msg.innerText = "❌ خطأ بتحميل الرصيد";
      return;
    }

    if (data.points < amount) {
      msg.innerText = "❌ رصيدك غير كافٍ";
      return;
    }

    // حالياً: تأكيد فقط (مراجعة يدوية)
    msg.innerText = "✅ تم إرسال طلب السحب. بانتظار المراجعة.";
  }

  function goBack() {
    window.location.href = "dashboard.html";
  }
</script>

</body>
</html>
